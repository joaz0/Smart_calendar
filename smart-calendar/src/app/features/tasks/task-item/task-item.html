<div class="task-item" 
     [class.completed]="task.completed"
     [class.overdue]="isOverdue"
     [class.high-priority]="task.priority === 'high'"
     [class.medium-priority]="task.priority === 'medium'"
     [class.low-priority]="task.priority === 'low'">

  <!-- Task Checkbox -->
  <div class="task-checkbox">
    <mat-checkbox 
      [(ngModel)]="task.completed"
      (change)="onToggleComplete()"
      [color]="task.priority === 'high' ? 'warn' : 'primary'">
    </mat-checkbox>
  </div>

  <!-- Task Content -->
  <div class="task-content" (click)="onTaskClick()">
    <!-- Main Info -->
    <div class="task-main">
      <h4 class="task-title" [class.strikethrough]="task.completed">
        {{ task.title }}
      </h4>
      
      <div class="task-meta">
        <!-- Priority Indicator -->
        <app-priority-indicator 
          [priority]="task.priority"
          [size]="'small'">
        </app-priority-indicator>

        <!-- Due Date -->
        <span class="due-date" *ngIf="task.dueDate">
          <mat-icon class="meta-icon">schedule</mat-icon>
          {{ task.dueDate | date:'shortDate' }}
          <span class="due-time" *ngIf="task.dueTime">
            {{ task.dueTime }}
          </span>
        </span>

        <!-- Category -->
        <span class="category" *ngIf="task.category">
          <span class="category-dot" [style.background-color]="task.category.color"></span>
          {{ task.category.name }}
        </span>

        <!-- Estimated Duration -->
        <span class="duration" *ngIf="task.estimatedDuration">
          <mat-icon class="meta-icon">timer</mat-icon>
          {{ formatDuration(task.estimatedDuration) }}
        </span>
      </div>

      <!-- Description -->
      <p class="task-description" *ngIf="task.description && showDescription">
        {{ task.description }}
      </p>

      <!-- Tags -->
      <div class="task-tags" *ngIf="task.tags && task.tags.length > 0">
        <mat-chip *ngFor="let tag of task.tags" class="task-tag">
          {{ tag }}
        </mat-chip>
      </div>

      <!-- Subtasks Progress -->
      <div class="subtasks-progress" *ngIf="task.subtasks && task.subtasks.length > 0">
        <div class="progress-info">
          <mat-icon class="progress-icon">checklist</mat-icon>
          <span>{{ getCompletedSubtasks() }}/{{ task.subtasks.length }} subtarefas</span>
        </div>
        <mat-progress-bar 
          mode="determinate" 
          [value]="getSubtaskProgress()"
          class="subtask-progress-bar">
        </mat-progress-bar>
      </div>
    </div>

    <!-- Overdue Warning -->
    <div class="overdue-warning" *ngIf="isOverdue && !task.completed">
      <mat-icon class="warning-icon">warning</mat-icon>
      <span>Atrasada</span>
    </div>
  </div>

  <!-- Task Actions -->
  <div class="task-actions">
    <button mat-icon-button 
            (click)="onEdit($event)"
            matTooltip="Editar tarefa"
            class="action-btn edit-btn">
      <mat-icon>edit</mat-icon>
    </button>

    <button mat-icon-button 
            [matMenuTriggerFor]="taskMenu"
            matTooltip="Mais opções"
            class="action-btn menu-btn"
            (click)="$event.stopPropagation()">
      <mat-icon>more_vert</mat-icon>
    </button>
  </div>

  <!-- Task Menu -->
  <mat-menu #taskMenu="matMenu">
    <button mat-menu-item (click)="onDuplicate()">
      <mat-icon>content_copy</mat-icon>
      <span>Duplicar</span>
    </button>
    
    <button mat-menu-item (click)="onSetReminder()">
      <mat-icon>alarm</mat-icon>
      <span>Definir Lembrete</span>
    </button>
    
    <button mat-menu-item (click)="onMoveToCategory()">
      <mat-icon>folder</mat-icon>
      <span>Mover para Categoria</span>
    </button>
    
    <mat-divider></mat-divider>
    
    <button mat-menu-item (click)="onDelete()" class="delete-item">
      <mat-icon>delete</mat-icon>
      <span>Excluir</span>
    </button>
  </mat-menu>

  <!-- Reminder Indicator -->
  <div class="reminder-indicator" *ngIf="task.hasReminder">
    <mat-icon class="reminder-icon">notifications</mat-icon>
  </div>

  <!-- Recurring Indicator -->
  <div class="recurring-indicator" *ngIf="task.isRecurring">
    <mat-icon class="recurring-icon">repeat</mat-icon>
  </div>
</div>