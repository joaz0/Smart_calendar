<div class="dialog-header">
  <h2 mat-dialog-title id="task-dialog-title" data-component="TaskDialogTitle">
    <mat-icon>{{ isEditing ? 'edit' : 'add_task' }}</mat-icon>
    {{ isEditing ? 'Editar Tarefa' : 'Nova Tarefa' }}
  </h2>
  <button mat-icon-button mat-dialog-close aria-label="Fechar diálogo">
    <mat-icon>close</mat-icon>
  </button>
</div>

<form data-component="TaskDialogForm" [formGroup]="taskForm" (ngSubmit)="onSubmit()" 
      role="form" aria-labelledby="task-dialog-title">
  <mat-dialog-content>
    <div class="form-grid">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Título *</mat-label>
        <input matInput formControlName="title" 
               placeholder="Digite o título da tarefa"
               maxlength="100"
               aria-describedby="task-title-hint">
        <mat-hint id="task-title-hint">Máximo 100 caracteres</mat-hint>
        <mat-error *ngIf="taskForm.get('title')?.hasError('required')">
          Título é obrigatório
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Descrição</mat-label>
        <textarea matInput formControlName="description"
                  placeholder="Adicione uma descrição"></textarea>
      </mat-form-field>

      <div class="due-date-section">
        <h3 class="section-title">
          <mat-icon>schedule</mat-icon>
          Prazo
        </h3>
        
        <div class="date-time-group">
          <mat-form-field appearance="outline">
            <mat-label>Data de Vencimento</mat-label>
            <input matInput [matDatepicker]="duePicker" formControlName="dueDate"
                   placeholder="Escolha a data de vencimento">
            <mat-datepicker-toggle matSuffix [for]="duePicker"></mat-datepicker-toggle>
            <mat-datepicker #duePicker></mat-datepicker>
            <mat-error *ngIf="taskForm.get('dueDate')?.hasError('required')">
              Data de vencimento é obrigatória
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Hora de Vencimento</mat-label>
            <input matInput type="time" [ngModel]="getTimeFromDate(taskForm.get('dueDate')?.value)"
                   (ngModelChange)="updateDueTime($event)" [ngModelOptions]="{standalone: true}"
                   placeholder="Escolha a hora de vencimento">
          </mat-form-field>
        </div>
      </div>

      <div class="task-details-section">
        <h3 class="section-title">
          <mat-icon>tune</mat-icon>
          Configurações
        </h3>
        
        <div class="priority-category-group">
          <mat-form-field appearance="outline">
            <mat-label>Prioridade</mat-label>
            <mat-select formControlName="priority">
              <mat-option value="low">
                <span class="priority-option low">
                  <mat-icon>flag</mat-icon>
                  Baixa
                </span>
              </mat-option>
              <mat-option value="medium">
                <span class="priority-option medium">
                  <mat-icon>flag</mat-icon>
                  Média
                </span>
              </mat-option>
              <mat-option value="high">
                <span class="priority-option high">
                  <mat-icon>flag</mat-icon>
                  Alta
                </span>
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Categoria</mat-label>
            <mat-select formControlName="category">
              <mat-option *ngFor="let category of categories" [value]="category">
                <span class="category-option">
                  <span class="category-color" [style.background-color]="category.color"></span>
                  {{ category.name }}
                </span>
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        
        <div class="status-section">
          <mat-checkbox formControlName="completed" class="completion-checkbox">
            <span class="checkbox-label">
              <mat-icon>{{ taskForm.get('completed')?.value ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
              Tarefa Concluída
            </span>
          </mat-checkbox>
        </div>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button type="button" mat-button (click)="onCancel()">Cancelar</button>
    <button type="button" mat-button color="warn" *ngIf="isEditing" (click)="onDelete()">
      Excluir
    </button>
    <button type="submit" mat-raised-button color="primary" [disabled]="taskForm.invalid">
      {{ isEditing ? 'Salvar' : 'Criar' }}
    </button>
  </mat-dialog-actions>
</form>]]>
