<div class="month-view-container">
  <!-- Month Header -->
  <div class="month-header">
    <div class="weekdays">
      @for (day of weekdays; track day) {
        <div class="weekday">
          {{ day }}
        </div>
      }
    </div>
  </div>

  <!-- Calendar Grid -->
  <div class="calendar-grid">
    @for (week of calendarWeeks; track week) {
      <div class="calendar-week">
        @for (day of week; track day) {
          <div class="calendar-day"
            [class.other-month]="!day.isCurrentMonth"
            [class.today]="day.isToday"
            [class.selected]="day.isSelected"
            [class.has-events]="day.events.length > 0"
            (click)="selectDate(day.date)"
            tabindex="0"
            (keyup.enter)="selectDate(day.date)">

            <!-- Day Number -->
            <div class="day-number">
              {{ day.date.getDate() }}
            </div>

            <!-- Events -->
            @if (day.events.length > 0) {
              <div class="day-events">
                @for (event of day.events | slice:0:maxEventsPerDay; track trackByEvent($index, event)) {
                  <div class="event-item"
                    [style.background-color]="$any(event).category?.color"
                    [class.all-day]="$any(event).allDay"
                    (click)="onEventClick($any(event), $event)"
                    (keyup.enter)="onEventClick($any(event), $event)"
                    (keydown.enter)="onEventClick($any(event), $event)"
                    (keydown.space)="onEventClick($any(event), $event)"
                    tabindex="0"
                    role="button"
                    [matTooltip]="getEventTooltip($any(event))">
                    <div class="event-content">
                      @if (!$any(event).allDay) {
                        <span class="event-time">
                          {{ $any(event).startTime | date:'shortTime' }}
                        </span>
                      }
                      <span class="event-title">{{ $any(event).title }}</span>
                    </div>
                  </div>
                }

                <!-- More Events Indicator -->
                @if (day.events.length > maxEventsPerDay) {
                  <div class="more-events"
                    (click)="showMoreEvents(day, $event)"
                    (keyup.enter)="showMoreEvents(day, $event)"
                    (keydown.enter)="showMoreEvents(day, $event)"
                    (keydown.space)="showMoreEvents(day, $event)"
                    tabindex="0"
                    role="button">
                    +{{ day.events.length - maxEventsPerDay }} mais
                  </div>
                }
              </div>
            }

            <!-- Add Event Button -->
            @if (day.isCurrentMonth) {
              <button class="add-event-btn"
                (click)="createEventOnDate(day.date, $event)"
                (keyup.enter)="createEventOnDate(day.date, $event)"
                matTooltip="Adicionar evento">
                <mat-icon>add</mat-icon>
              </button>
            }
          </div>
        }
      </div>
    }
  </div>

  <!-- Mini Calendar Navigation -->
  @if (showMiniNav) {
    <div class="mini-nav">
      <button mat-icon-button
        (click)="previousMonth()"
        (keyup.enter)="previousMonth()"
        tabindex="0">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <span class="current-month">{{ currentMonthName }}</span>
      <button mat-icon-button
        (click)="nextMonth()"
        (keyup.enter)="nextMonth()"
        tabindex="0">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  }
</div>
