<header class="app-header" role="banner">
  <div class="header-inner">
    <!-- Menu Toggle -->
    <button mat-icon-button 
            class="menu-toggle" 
            (click)="onToggleSidebar()" 
            matTooltip="Alternar menu lateral"
            matTooltipPosition="below"
            aria-label="Alternar menu lateral">
      <mat-icon>menu</mat-icon>
    </button>
    
    <!-- Brand -->
    <div class="brand">
      <div class="logo-container">
        <img src="/assets/images/Logo_light.png" 
             alt="AgendaRápido" 
             class="logo-img"
             loading="lazy"> 
      </div>
      <div class="brand-text">
        <span class="brand-name">AgendaRápido</span>
        <span class="brand-tagline">Smart Calendar</span>
      </div>
    </div>
    
    <!-- Header Center -->
    <div class="header-center">
      <div class="greeting-section">
        <div class="greeting">{{ greeting() }}, {{ user.name || 'Usuário' }}</div>
        <div class="time-info">
          <span class="current-time">{{ currentTime() | date:'HH:mm:ss' }}</span>
          <span class="connection-status" [class.offline]="!isOnline()">
            <mat-icon class="status-icon">{{ isOnline() ? 'wifi' : 'wifi_off' }}</mat-icon>
            {{ getConnectionStatus() }}
          </span>
        </div>
      </div>
    </div>
    
    <!-- Header Actions -->
    <div class="header-actions">
      <!-- Theme Toggle -->
      <app-theme-toggle></app-theme-toggle>
      
      <!-- Notifications -->
      <button mat-icon-button 
              class="action-btn notifications-btn"
              (click)="onOpenNotifications()"
              [matBadge]="notifications()"
              [matBadgeHidden]="notifications() === 0"
              matBadgeColor="warn"
              matBadgeSize="small"
              matTooltip="Notificações"
              aria-label="Notificações">
        <mat-icon>notifications</mat-icon>
      </button>
      
      <!-- User Profile -->
      <div class="user-profile" 
           (click)="onOpenProfile()"
           [matMenuTriggerFor]="userMenu"
           matTooltip="Perfil do usuário"
           role="button"
           tabindex="0"
           (keydown.enter)="onOpenProfile()"
           (keydown.space)="onOpenProfile()">
        <div class="user-avatar">
          <img *ngIf="user.avatar; else initials" 
               [src]="user.avatar" 
               [alt]="user.name || 'Avatar'"
               class="avatar-img"
               loading="lazy">
          <ng-template #initials>
            <span class="avatar-text">{{ getUserInitials() }}</span>
          </ng-template>
        </div>
        <div class="user-info">
          <span class="user-name">{{ user.name || 'Usuário' }}</span>
          <span class="user-role">{{ user.role || 'Usuário' }}</span>
        </div>
        <mat-icon class="dropdown-icon">expand_more</mat-icon>
      </div>
      
      <!-- Quick Logout -->
      <button mat-icon-button 
              class="action-btn logout-btn" 
              (click)="onLogout()" 
              matTooltip="Sair"
              aria-label="Sair">
        <mat-icon>logout</mat-icon>
      </button>
    </div>
  </div>
  
  <!-- User Menu -->
  <mat-menu #userMenu="matMenu" class="user-dropdown">
    <button mat-menu-item (click)="onOpenProfile()">
      <mat-icon>person</mat-icon>
      <span>Meu Perfil</span>
    </button>
    <button mat-menu-item>
      <mat-icon>settings</mat-icon>
      <span>Configurações</span>
    </button>
    <button mat-menu-item>
      <mat-icon>help</mat-icon>
      <span>Ajuda</span>
    </button>
    <mat-divider></mat-divider>
    <button mat-menu-item (click)="onLogout()" class="logout-menu-item">
      <mat-icon>logout</mat-icon>
      <span>Sair</span>
    </button>
  </mat-menu>
</header>