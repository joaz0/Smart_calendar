<header class="app-header" [class.scrolled]="isScrolled">
  <!-- Left Section -->
  <div class="header-left">
    <button class="sidebar-toggle"
      (click)="onToggleSidebar()"
      [attr.aria-label]="sidebarOpen ? 'Fechar sidebar' : 'Abrir sidebar'">
      <mat-icon>menu</mat-icon>
    </button>

    <a routerLink="/" class="header-logo">
      @if (logoUrl) {
        <img src="assets/images/logo.svg" alt="SmartCalendar">
      }
      <span class="logo-text">SmartCalendar</span>
    </a>

    @if (breadcrumbs && breadcrumbs.length > 0) {
      <nav class="breadcrumb">
        @for (crumb of breadcrumbs; track crumb; let last = $last) {
          <a [routerLink]="crumb.route || crumb.url"
            class="breadcrumb-item"
            [class.current]="last">
            @if (crumb.icon) {
              <mat-icon>{{ crumb.icon }}</mat-icon>
            }
            <span>{{ crumb.label }}</span>
          </a>
          @if (!last) {
            <span class="breadcrumb-separator">/</span>
          }
        }
      </nav>
    }
  </div>

  <!-- Center Section -->
  <div class="header-center">
    @if (showSearch) {
      <app-search-bar></app-search-bar>
    }
  </div>

  <!-- Right Section -->
  <div class="header-right">
    <!-- Action Buttons -->
    <div class="header-actions">
      <button class="header-btn theme-toggle"
        (click)="onToggleTheme()"
        [attr.aria-label]="isDarkTheme ? 'Mudar para modo claro' : 'Mudar para modo escuro'">
        <mat-icon>{{ isDarkTheme ? 'light_mode' : 'dark_mode' }}</mat-icon>
      </button>

      <button class="header-btn notifications-btn"
        [matMenuTriggerFor]="notificationsMenu"
        [attr.aria-label]="'Notificações' + (unreadCount() > 0 ? ': ' + unreadCount() + ' não lidas' : '')">
        <mat-icon>notifications</mat-icon>
        @if (unreadCount() > 0) {
          <span class="notification-badge">{{ unreadCount() }}</span>
        }
      </button>
    </div>

    <!-- Divider -->
    <div class="divider"></div>

    <!-- User Menu -->
    <button class="user-menu-btn" [matMenuTriggerFor]="userMenu">
      <div class="user-avatar">
        @if (user.avatar) {
          <img [src]="user.avatar" [alt]="user.name">
        }
        @if (!user.avatar) {
          <span>{{ getUserInitials() }}</span>
        }
        <span class="user-status" [class]="user.status"></span>
      </div>
      <div class="user-info">
        <span class="user-name">{{ user.name }}</span>
        <span class="user-role">{{ user.role }}</span>
      </div>
      <mat-icon>expand_more</mat-icon>
    </button>
  </div>
</header>

<!-- User Menu -->
<mat-menu #userMenu="matMenu" class="user-menu">
  <div class="user-menu-header">
    <div class="user-avatar-large">{{ getUserInitials() }}</div>
    <div class="user-details">
      <strong>{{ user.name }}</strong>
      <small>{{ user.email }}</small>
    </div>
  </div>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="onOpenProfile()">
    <mat-icon>person</mat-icon>
    <span>Meu Perfil</span>
  </button>
  <button mat-menu-item (click)="onOpenSettings()">
    <mat-icon>settings</mat-icon>
    <span>Configurações</span>
  </button>
  <button mat-menu-item>
    <mat-icon>help_outline</mat-icon>
    <span>Ajuda</span>
  </button>
  <mat-divider></mat-divider>
  <button mat-menu-item (click)="onLogout()">
    <mat-icon>logout</mat-icon>
    <span>Sair</span>
  </button>
</mat-menu>

<!-- Notifications Menu -->
<mat-menu #notificationsMenu="matMenu" class="notifications-panel">
  <div class="notifications-header">
    <strong>Notificações</strong>
    @if (unreadCount() > 0) {
      <button mat-icon-button (click)="markAllAsRead()">
        <mat-icon>done_all</mat-icon>
      </button>
    }
  </div>
  <div class="notifications-list">
    @for (notification of notifications | slice:0:5; track notification) {
      <div
        class="notification-item"
        [class.unread]="!notification.read"
        (click)="openNotification(notification)">
        <mat-icon [class]="'notification-icon ' + notification.type">
          {{ getNotificationIcon(notification.type) }}
        </mat-icon>
        <div class="notification-content">
          <span class="notification-title">{{ notification.title }}</span>
          <span class="notification-message">{{ notification.message }}</span>
          <span class="notification-time">{{ notification.timestamp | date:'short' }}</span>
        </div>
      </div>
    }
    @if (!notifications || notifications.length === 0) {
      <div class="notifications-empty">
        <mat-icon>notifications_none</mat-icon>
        <p>Nenhuma notificação</p>
      </div>
    }
  </div>
  <div class="notifications-footer">
    <button mat-button (click)="viewAllNotifications()">Ver todas</button>
  </div>
</mat-menu>