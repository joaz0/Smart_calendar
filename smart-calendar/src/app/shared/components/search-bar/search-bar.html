<div class="search-bar-container">
  <div class="search-input-wrapper">
    <mat-icon class="search-icon">search</mat-icon>
    
    <input class="search-input"
           type="text"
           [(ngModel)]="searchTerm"
           (input)="onSearchInput()"
           (focus)="onFocus()"
           (blur)="onBlur()"
           (keydown)="onKeyDown($event)"
           [placeholder]="placeholder"
           #searchInput>
    
    <button class="clear-btn"
            *ngIf="searchTerm"
            (click)="clearSearch()"
            matTooltip="Limpar busca">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Search Results Dropdown -->
  <div class="search-results" 
       *ngIf="showResults && (searchResults.length > 0 || isSearching)"
       [@slideInOut]>
    
    <!-- Loading -->
    <div class="search-loading" *ngIf="isSearching">
      <mat-spinner diameter="20"></mat-spinner>
      <span>Buscando...</span>
    </div>

    <!-- Results -->
    <div class="results-list" *ngIf="!isSearching && searchResults.length > 0">
      <div class="result-group" *ngFor="let group of groupedResults">
        <div class="group-header">
          <mat-icon class="group-icon">{{ group.icon }}</mat-icon>
          <span class="group-title">{{ group.title }}</span>
          <span class="group-count">({{ group.items.length }})</span>
        </div>
        
        <div class="group-items">
          <div class="result-item"
               *ngFor="let item of group.items; let i = index"
               [class.highlighted]="i === selectedIndex"
               (click)="selectResult(item)"
               (mouseenter)="highlightResult(i)">
            
            <div class="result-icon">
              <mat-icon [style.color]="item.color || '#666'">{{ item.icon }}</mat-icon>
            </div>
            
            <div class="result-content">
              <div class="result-title" [innerHTML]="highlightSearchTerm(item.title)"></div>
              <div class="result-subtitle" *ngIf="item.subtitle">
                {{ item.subtitle }}
              </div>
              <div class="result-meta" *ngIf="item.date">
                <mat-icon class="meta-icon">schedule</mat-icon>
                {{ item.date | date:'shortDate' }}
              </div>
            </div>
            
            <div class="result-actions">
              <button mat-icon-button 
                      (click)="quickAction(item, $event)"
                      *ngIf="item.quickAction"
                      [matTooltip]="item.quickAction.tooltip">
                <mat-icon>{{ item.quickAction.icon }}</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- No Results -->
    <div class="no-results" *ngIf="!isSearching && searchResults.length === 0 && searchTerm">
      <mat-icon class="no-results-icon">search_off</mat-icon>
      <p>Nenhum resultado encontrado para "{{ searchTerm }}"</p>
      <button mat-button color="primary" (click)="createFromSearch()">
        <mat-icon>add</mat-icon>
        Criar "{{ searchTerm }}"
      </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions" *ngIf="showQuickActions && !searchTerm">
      <div class="quick-action" 
           *ngFor="let action of quickActions"
           (click)="executeQuickAction(action)">
        <mat-icon class="action-icon">{{ action.icon }}</mat-icon>
        <span class="action-label">{{ action.label }}</span>
      </div>
    </div>

    <!-- Recent Searches -->
    <div class="recent-searches" *ngIf="showRecentSearches && recentSearches.length > 0 && !searchTerm">
      <div class="section-header">
        <span>Buscas Recentes</span>
        <button mat-button (click)="clearRecentSearches()">Limpar</button>
      </div>
      <div class="recent-item"
           *ngFor="let recent of recentSearches"
           (click)="selectRecentSearch(recent)">
        <mat-icon class="recent-icon">history</mat-icon>
        <span class="recent-text">{{ recent }}</span>
        <button mat-icon-button 
                (click)="removeRecentSearch(recent, $event)"
                class="remove-recent">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Search Backdrop -->
  <div class="search-backdrop" 
       *ngIf="showResults"
       (click)="closeResults()">
  </div>
</div>