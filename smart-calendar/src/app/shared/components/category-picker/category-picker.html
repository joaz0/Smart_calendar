<div class="category-picker">
  <div 
    class="selected-category" 
    (click)="toggleDropdown()"
    [class.disabled]="disabled"
  >
    <div 
      class="category-color" 
      [style.backgroundColor]="selectedCategory?.color || '#9ca3af'"
    ></div>
    <span class="category-name">
      {{ selectedCategory?.name || 'Selecionar Categoria' }}
    </span>
    <div class="dropdown-arrow">{{ isOpen ? '‚ñ¥' : '‚ñæ' }}</div>
  </div>

  <div class="categories-dropdown" *ngIf="isOpen">
    <div class="dropdown-content">
      <!-- Categorias Padr√£o -->
      <div 
        *ngFor="let category of defaultCategories"
        class="category-option"
        [class.selected]="selectedCategory?.id === category.id"
        (click)="selectCategory(category)"
      >
        <div class="category-color" [style.backgroundColor]="category.color"></div>
        <span class="category-name">{{ category.name }}</span>
        <div class="category-count" *ngIf="getCategoryCount(category) > 0">
          {{ getCategoryCount(category) }}
        </div>
      </div>

      <!-- Divisor (s√≥ mostra se houver categorias personalizadas) -->
      <div class="dropdown-divider" *ngIf="customCategories.length > 0"></div>

      <!-- Categorias Personalizadas -->
      <div 
        *ngFor="let category of customCategories"
        class="category-option"
        [class.selected]="selectedCategory?.id === category.id"
        (click)="selectCategory(category)"
      >
        <div class="category-color" [style.backgroundColor]="category.color"></div>
        <span class="category-name">{{ category.name }}</span>
        <div class="category-actions" (click)="$event.stopPropagation()">
          <button 
            class="action-btn" 
            (click)="editCategory(category, $event)"
            title="Editar categoria"
          >
            ‚úèÔ∏è
          </button>
          <button 
            class="action-btn" 
            (click)="deleteCategory(category, $event)"
            title="Excluir categoria"
          >
            üóëÔ∏è
          </button>
        </div>
      </div>

      <!-- Adicionar Nova Categoria -->
      <div class="dropdown-divider"></div>
      <div class="add-category" (click)="addNewCategory()">
        <div class="add-icon">+</div>
        <span>Nova Categoria</span>
      </div>
    </div>
  </div>

  <!-- Modal de Edi√ß√£o de Categoria -->
  <div class="category-modal" *ngIf="showCategoryModal">
    <div class="modal-overlay" (click)="closeModal()"></div>
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>{{ editingCategory ? 'Editar Categoria' : 'Nova Categoria' }}</h3>
      
      <div class="form-group">
        <label>Nome da Categoria</label>
        <input 
          type="text" 
          [(ngModel)]="categoryName"
          placeholder="Ex: Trabalho, Pessoal, Sa√∫de..."
          class="form-input"
          (keyup.enter)="saveCategory()"
          autofocus
        />
      </div>

      <div class="form-group">
        <label>Cor</label>
        <div class="color-palette">
          <div 
            *ngFor="let color of colorPalette"
            class="color-option"
            [class.selected]="selectedColor === color"
            [style.backgroundColor]="color"
            (click)="selectColor(color)"
            [title]="color"
          ></div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-secondary" (click)="closeModal()">Cancelar</button>
        <button 
          class="btn-primary" 
          (click)="saveCategory()"
          [disabled]="!categoryName.trim()"
        >
          Salvar
        </button>
      </div>
    </div>
  </div>
</div>