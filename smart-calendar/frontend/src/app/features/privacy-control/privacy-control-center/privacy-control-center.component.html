<div class="privacy-control-center">
  <div class="header">
    <h2><mat-icon>security</mat-icon> Centro de Controle de Privacidade</h2>
  </div>

  @if (settings) {
    <section class="score-banner">
      <div class="score-card" [class.low]="privacyLevel === 'baixa'" [class.medium]="privacyLevel === 'media'">
        <p class="eyebrow">Pontua√ß√£o de privacidade</p>
        <div class="score">{{ privacyScore }}%</div>
        <p class="hint">C√°lculo baseado em compartilhamento, rastreamento e visibilidade</p>
      </div>
      <div class="score-meta">
        <div>
          <p class="eyebrow">N√≠vel</p>
          <span class="pill">{{ privacyLevel === 'alta' ? 'Alta prote√ß√£o' : privacyLevel === 'media' ? 'Moderada' : 'Em risco' }}</span>
        </div>
        @if (lastLog) {
          <div class="last-log">
            <p class="eyebrow">√öltimo acesso</p>
            <strong>{{ formatDate(lastLog.timestamp) }}</strong>
            <span class="hint">{{ lastLog.resource }} ({{ lastLog.action }})</span>
          </div>
        }
      </div>
    </section>

    <div class="content">
      <mat-card class="presets-card">
        <mat-card-header><mat-card-title>Presets r√°pidos</mat-card-title></mat-card-header>
        <mat-card-content>
          <div class="preset-actions">
            <button mat-stroked-button color="primary" (click)="applyPreset('estrito')">
              <mat-icon>shield</mat-icon>
              M√°xima privacidade
            </button>
            <button mat-stroked-button color="accent" (click)="applyPreset('colaborativo')">
              <mat-icon>group</mat-icon>
              Colabora√ß√£o segura
            </button>
          </div>
          <p class="hint">Voc√™ pode personalizar abaixo mesmo ap√≥s aplicar um preset.</p>
        </mat-card-content>
      </mat-card>

      <mat-card class="settings-card">
        <mat-card-header><mat-card-title>Configura√ß√µes de Privacidade</mat-card-title></mat-card-header>
        <mat-card-content>
          <div class="setting-item">
            <div class="setting-info">
              <mat-icon>share</mat-icon>
              <div>
                <div class="setting-title">Compartilhamento de Dados</div>
                <div class="setting-description">Permitir compartilhamento de dados com terceiros</div>
              </div>
            </div>
            <mat-slide-toggle [(ngModel)]="settings.dataSharing" (change)="updateSettings()"></mat-slide-toggle>
          </div>
          <mat-divider></mat-divider>
          <div class="setting-item">
            <div class="setting-info">
              <mat-icon>analytics</mat-icon>
              <div>
                <div class="setting-title">Rastreamento de Analytics</div>
                <div class="setting-description">Coletar dados de uso para melhorar o servi√ßo</div>
              </div>
            </div>
            <mat-slide-toggle [(ngModel)]="settings.analyticsTracking" (change)="updateSettings()"></mat-slide-toggle>
          </div>
          <mat-divider></mat-divider>
          <div class="setting-item">
            <div class="setting-info">
              <mat-icon>location_on</mat-icon>
              <div>
                <div class="setting-title">Rastreamento de Localiza√ß√£o</div>
                <div class="setting-description">Permitir acesso √† sua localiza√ß√£o</div>
              </div>
            </div>
            <mat-slide-toggle [(ngModel)]="settings.locationTracking" (change)="updateSettings()"></mat-slide-toggle>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="notifications-card">
        <mat-card-header><mat-card-title>Prefer√™ncias de Notifica√ß√£o</mat-card-title></mat-card-header>
        <mat-card-content>
          <div class="setting-item">
            <div class="setting-info">
              <mat-icon>email</mat-icon>
              <div class="setting-title">Notifica√ß√µes por Email</div>
            </div>
            <mat-slide-toggle [(ngModel)]="settings.notificationPreferences.email" (change)="updateSettings()"></mat-slide-toggle>
          </div>
          <mat-divider></mat-divider>
          <div class="setting-item">
            <div class="setting-info">
              <mat-icon>notifications</mat-icon>
              <div class="setting-title">Notifica√ß√µes Push</div>
            </div>
            <mat-slide-toggle [(ngModel)]="settings.notificationPreferences.push" (change)="updateSettings()"></mat-slide-toggle>
          </div>
          <mat-divider></mat-divider>
          <div class="setting-item">
            <div class="setting-info">
              <mat-icon>sms</mat-icon>
              <div class="setting-title">Notifica√ß√µes por SMS</div>
            </div>
            <mat-slide-toggle [(ngModel)]="settings.notificationPreferences.sms" (change)="updateSettings()"></mat-slide-toggle>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="visibility-card">
        <mat-card-header><mat-card-title>Configura√ß√µes de Visibilidade</mat-card-title></mat-card-header>
        <mat-card-content>
          <div class="visibility-setting">
            <div class="vis-label">
              <mat-icon>calendar_today</mat-icon>
              <span>Calend√°rio</span>
            </div>
            <mat-select [(ngModel)]="settings.visibilitySettings.calendar" (selectionChange)="updateSettings()">
              <mat-option value="public">P√∫blico</mat-option>
              <mat-option value="team">Equipe</mat-option>
              <mat-option value="private">Privado</mat-option>
            </mat-select>
          </div>
          <div class="visibility-setting">
            <div class="vis-label">
              <mat-icon>task_alt</mat-icon>
              <span>Tarefas</span>
            </div>
            <mat-select [(ngModel)]="settings.visibilitySettings.tasks" (selectionChange)="updateSettings()">
              <mat-option value="public">P√∫blico</mat-option>
              <mat-option value="team">Equipe</mat-option>
              <mat-option value="private">Privado</mat-option>
            </mat-select>
          </div>
          <div class="visibility-setting">
            <div class="vis-label">
              <mat-icon>person</mat-icon>
              <span>Perfil</span>
            </div>
            <mat-select [(ngModel)]="settings.visibilitySettings.profile" (selectionChange)="updateSettings()">
              <mat-option value="public">P√∫blico</mat-option>
              <mat-option value="private">Privado</mat-option>
            </mat-select>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="access-logs-card">
        <mat-card-header><mat-card-title>Hist√≥rico de Acesso aos Dados</mat-card-title></mat-card-header>
        <mat-card-content>
          @for (log of accessLogs; track log) {
            <div class="log-item">
              <mat-icon>{{getActionIcon(log.action)}}</mat-icon>
              <div class="log-details">
                <div class="log-title">{{log.action | uppercase}}: {{log.resource}}</div>
                <div class="log-meta">
                  <span>{{formatDate(log.timestamp)}}</span>
                  @if (log.ipAddress) {
                    <span>‚Ä¢ IP: {{log.ipAddress}}</span>
                  }
                </div>
              </div>
            </div>
          }
        </mat-card-content>
      </mat-card>

      <mat-card class="danger-zone-card">
        <mat-card-header><mat-card-title><mat-icon>warning</mat-icon> Zona de Perigo</mat-card-title></mat-card-header>
        <mat-card-content>
          <div class="danger-actions">
            <div class="action-item">
              <div>
                <div class="action-title">Exportar Seus Dados</div>
                <div class="action-description">Baixe uma c√≥pia de todos os seus dados</div>
              </div>
              <button mat-stroked-button color="primary" (click)="exportData()" [disabled]="loading">
                <mat-icon>download</mat-icon>
                Exportar
              </button>
            </div>
            <mat-divider></mat-divider>
            <div class="action-item">
              <div>
                <div class="action-title">Excluir Conta</div>
                <div class="action-description">Excluir permanentemente sua conta e todos os dados</div>
              </div>
              @if (!isDemoUser) {
                <button mat-stroked-button color="warn" (click)="deleteAccount()">
                  <mat-icon>delete_forever</mat-icon>
                  Excluir Conta
                </button>
              }
              @if (isDemoUser) {
                <div class="demo-warning">
                  üîí Configura√ß√µes de conta bloqueadas na Demo
                </div>
              }
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  }
</div>
